in: |
  deployments:
    {{- define "createDeployment" }}
    {{- $type := .type }}
    {{- $count := .count }}
    {{- $valuesFile := .valuesFile }}
    {{- if gt (conv.ToInt $count) 0 }}
    {{- range $i := seq 1 $count }}
    {{ $type }}-{{ $i }}:
      namespace: ${NAMESPACE}
      helm:
        displayOutput: true
        chart:
          name: oci://ghcr.io/ajgrande924/registry/besu-node
          version: 0.1.1
        values:
          storage:
            enabled: {{ ".Env.CREATE_STORAGE_CLASS" | conv.ToBool }}
        valuesFiles:
          - {{ $valuesFile }}
    {{- end }}
    {{- end }}
    {{- end }}

    {{- $bootNodeCount := .Env.BOOT_NODE_COUNT }}
    {{- $validatorNodeCount := .Env.VALIDATOR_NODE_COUNT }}
    {{- $rpcNodeCount := .Env.RPC_NODE_COUNT }}
    {{- $memberNodeCount := .Env.MEMBER_NODE_COUNT }}

    {{- template "createDeployment" (dict "type" "bootnode" "count" $bootNodeCount "valuesFile" "${LOCAL_VALUES_DIR}/bootnode.yaml") }}
    {{- template "createDeployment" (dict "type" "validator" "count" $validatorNodeCount "valuesFile" "${LOCAL_VALUES_DIR}/common.yaml") }}
    {{- template "createDeployment" (dict "type" "rpc" "count" $rpcNodeCount "valuesFile" "${LOCAL_VALUES_DIR}/common.yaml") }}
    {{- template "createDeployment" (dict "type" "member" "count" $memberNodeCount "valuesFile" "${LOCAL_VALUES_DIR}/member.yaml") }}
