in: |
  deployments:
    blockscout-postgres-{{ .Env.ETHEREUM_VARIANT }}-chain-{{ .Env.CHAIN_NAME }}-{{ .Env.CHAIN_ID }}:
      helm:
        displayOutput: true
        values:
          primary:
            persistence:
              enabled: false

    blockscout-{{ .Env.ETHEREUM_VARIANT }}-chain-{{ .Env.CHAIN_NAME }}-{{ .Env.CHAIN_ID }}:
      helm:
        displayOutput: true
        values:
          blockscout:
            {{- if eq .Env.ETHEREUM_VARIANT "geth" }}
            # TODO: Deploy this and validate
            # # Deploy Indexer and API separately to increase stability and simplify debugging
            # separateApi:
            #   enabled: true
            #   replicaCount: 1
            env:
              DATABASE_URL: 'postgresql://blockscout:blockscout123@blockscout-postgres-{{ .Env.ETHEREUM_VARIANT }}-chain-{{ .Env.CHAIN_NAME }}-{{ .Env.CHAIN_ID }}.${NAMESPACE}.svc.cluster.local:5432/blockscout?ssl=false'
              ETHEREUM_JSONRPC_HTTP_URL: 'http://{{ .Env.ETHEREUM_VARIANT }}-{{ .Env.CHAIN_ID }}.${NAMESPACE}.svc.cluster.local:8544'
              ETHEREUM_JSONRPC_TRACE_URL: 'http://{{ .Env.ETHEREUM_VARIANT }}-{{ .Env.CHAIN_ID }}.${NAMESPACE}.svc.cluster.local:8544'
              ETHEREUM_JSONRPC_WS_URL: 'ws://{{ .Env.ETHEREUM_VARIANT }}-{{ .Env.CHAIN_ID }}.${NAMESPACE}.svc.cluster.local:8546'
              ETHEREUM_JSONRPC_VARIANT: {{ .Env.ETHEREUM_VARIANT }}
              ECTO_USE_SSL: 'false'
              CHECK_ORIGIN: 'false'
            {{- end }}
            ingress:
              {{- if eq .Env.ETHEREUM_VARIANT "geth" }}
              hostname: {{ .Env.NAMESPACE }}-blockscout-{{ .Env.ETHEREUM_VARIANT }}-{{ .Env.CHAIN_ID }}-backend.{{ .Env.DEVSPACE_INGRESS_BASE_DOMAIN }}
              {{- end }}
              className: nginx
              paths:
                - path: /
                  pathType: Prefix
            resources:
              limits:
                memory: '2Gi'
                cpu: '1'
              requests:
                memory: '512Mi'
                cpu: '200m'
          frontend:
            env:
              NEXT_PUBLIC_API_PROTOCOL: "http"
              NEXT_PUBLIC_API_PORT: 80
              NEXT_PUBLIC_API_WEBSOCKET_PROTOCOL: "ws"
              NEXT_PUBLIC_APP_PROTOCOL: "http"
            ingress:
              {{- if eq .Env.ETHEREUM_VARIANT "geth" }}
              hostname: {{ .Env.NAMESPACE }}-blockscout-{{ .Env.ETHEREUM_VARIANT }}-{{ .Env.CHAIN_ID }}.{{ .Env.DEVSPACE_INGRESS_BASE_DOMAIN }}
              {{- end }}
              className: nginx
              paths:
                - path: /
                  pathType: Prefix
            resources:
              limits:
                memory: '2Gi'
                cpu: '1'
              requests:
                memory: '512Mi'
                cpu: '100m'
