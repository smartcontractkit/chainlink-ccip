atlas-core:
  base: &base
    labels:
      chain.link/team: crib
    image:
      tag: 3ad88f9f227762a96a73a0b7837ec5405c2d37bf
    envFromSecrets:
      - crib-secrets

  evm-blocks:
    <<: *base
    topologySpreadConstraints: []
    name: crib-evm-blocks-ethereum-mainnet
    envVars:
      APP_NAME: crib-evm-blocks-ethereum-mainnet
      BLOCKS_CHANNEL_LENGTH: "100"
      BLOCKS_KAFKA_BACKFILL_TOPIC: ethereum-mainnet_blocks_state
      BLOCKS_KAFKA_BLOCK_HEADERS_TOPIC: ethereum-mainnet_block_headers
      BLOCKS_KAFKA_INCLUSIONS_TOPIC: ethereum-mainnet_block_inclusions
      BLOCKS_KAFKA_TRANSACTIONS_TOPIC: ethereum-mainnet_transactions
      BLOCKS_STATE_WINDOW_MAX: "10000"
      BLOCKS_STATE_WINDOW_MIN: "200"
      CHAIN_ID: 1337
      KAFKA_CLIENT_ID: atlas-evm-blocks-ethereum-mainnet
      KAFKA_COMPRESSION_TYPE: zstd
      KAFKA_GROUP_ID: atlas-evm-blocks-ethereum-mainnet
      KAFKA_PRODUCER_MAX_MESSAGE_SIZE_BYTES: "8388608"
      KAFKA_SCHEMA_REGISTRY_REQUEST_TIMEOUT_MS: 30000
      LOG_LEVEL: info
      NETWORK_NAME: ethereum-mainnet
      RPC_ENDPOINTS: http://geth-1337:8544
      KAFKA_SECURITY_PROTOCOL: PLAINTEXT
      KAFKA_SASL_MECHANISM: PLAIN

  evm-logs:
    <<: *base
    topologySpreadConstraints: []
    name: crib-evm-logs-ethereum-mainnet
    envVars:
      APP_NAME: crib-evm-logs-ethereum-mainnet
      CHAIN_ID: 1337
      FAILED_MESSAGES_MAX_RETRY_COUNT: "10"
      KAFKA_BLOCK_HEADERS_TOPIC: ethereum-mainnet_block_headers
      KAFKA_BLOCK_LOGS_TOPIC: ethereum-mainnet_logs
      KAFKA_CLIENT_ID: atlas-evm-logs-ethereum-mainnet
      KAFKA_COMPRESSION_TYPE: zstd
      KAFKA_GROUP_ID: atlas-evm-logs-ethereum-mainnet
      KAFKA_PRODUCER_MAX_MESSAGE_SIZE_BYTES: "8388608"
      KAFKA_SCHEMA_REGISTRY_REQUEST_TIMEOUT_MS: 30000
      LOG_LEVEL: info
      NETWORK_NAME: ethereum-mainnet
      PROFILING: "true"
      RPC_CALL_TIMEOUT: 10s
      RPC_ENDPOINT: http://geth-1337:8544
      KAFKA_SECURITY_PROTOCOL: PLAINTEXT
      KAFKA_SASL_MECHANISM: PLAIN

  evm-receipts:
    <<: *base
    topologySpreadConstraints: []
    name: crib-evm-receipts-ethereum-mainnet
    envVars:
      KAFKA_CONSUMER_MAX_POLL_INTERVAL_MS: "1m"
      RECEIPTS_ENABLE_PARALLEL_BATCH: "false"
      RECEIPTS_MAX_RETRY_DURATION: "45s"
      APP_NAME: crib-evm-receipts-ethereum-mainnet
      CHAIN_ID: 1337
      KAFKA_CLIENT_ID: atlas-evm-receipts-ethereum-mainnet
      KAFKA_COMPRESSION_TYPE: zstd
      KAFKA_GROUP_ID: atlas-evm-receipts-ethereum-mainnet
      KAFKA_PRODUCER_MAX_MESSAGE_SIZE_BYTES: "8388608"
      KAFKA_SCHEMA_REGISTRY_REQUEST_TIMEOUT_MS: 30000
      LOG_LEVEL: info
      NETWORK_NAME: ethereum-mainnet
      OTEL_URL: otel-collector-opentelemetry-collector.o11y:4318
      PROFILING: "true"
      RECEIPTS_BATCH_SIZE: "1000"
      RECEIPTS_BATCH_WAIT_DURATION: 100ms
      RECEIPTS_KAFKA_RECEIPTS_TOPIC: ethereum-mainnet_transactions_with_receipts
      RECEIPTS_KAFKA_TRANSACTIONS_TOPIC: ethereum-mainnet_transactions
      RPC_ENDPOINTS: http://geth-1337:8544
      KAFKA_SECURITY_PROTOCOL: PLAINTEXT
      KAFKA_SASL_MECHANISM: PLAIN

  evm-logs-abi-decoder:
    <<: *base
    name: crib-evm-logs-abi-decoder-ethereum-mainnet
    topologySpreadConstraints: []
    envVars:
      KAFKA_ABI_DECODED_LOGS_DLQ_TOPIC: atlas_ethereum-mainnet_events_dlq
      KAFKA_ABI_DECODED_LOGS_TOPIC: atlas_ethereum-mainnet_events
      KAFKA_CLIENT_ID: atlas-evm-logs-abi-decoder-ethereum-mainnet
      KAFKA_GROUP_ID: atlas-evm-logs-abi-decoder-ethereum-mainnet
      KAFKA_LOGS_TOPIC: ethereum-mainnet_logs
      KAFKA_SCHEMA_REGISTRY_EVENTS_KEY_SUBJECT: atlas_ethereum-mainnet_events-key
      KAFKA_SCHEMA_REGISTRY_EVENTS_VALUE_SUBJECT: atlas_ethereum-mainnet_events-value
      TLS_ENABLED: false
      LOG_LEVEL: info
      CHAIN_ID: 1337
      NETWORK_NAME: ethereum-mainnet
      KAFKA_SECURITY_PROTOCOL: PLAINTEXT
      KAFKA_SASL_MECHANISM: "none"
      KAFKA_SASL_USERNAME:
      KAFKA_SASL_PASSWORD:
      KAFKA_SCHEMA_REGISTRY_BASIC_AUTH: "false"
      ABI_DIRECTORY: "/app/abi"
    service:
      # this benthos app has the port hardcoded to 4195
      port: 4195
    # benthos app uses a different endpoint for liveness
    livenessProbe:
      httpGet:
        path: /ping


atlas-evm-ccip-exporter:
  <<: *base
  topologySpreadConstraints: []
  name: atlas-evm-ccip-exporter-ethereum-mainnet
  envVars:
    APP_NAME: crib-evm-ccip-exporter-ethereum-mainnet-ccip-exporter
    CHAIN_ID: 1337
    NATIVE_SYMBOL: AVAX
    NETWORK_NAME: ethereum-mainnet
    KAFKA_LOGS_TOPIC: ethereum-mainnet_logs
    BLOCKS_KAFKA_BLOCK_HEADERS_TOPIC: ethereum-mainnet_block_headers
    KAFKA_OCR2_CCIP_COMMIT_TELEMETRY_TOPIC: atlas_ethereum-mainnet_ocr2_telemetry_ccip_commit_v0
    KAFKA_OCR2_CCIP_EXEC_TELEMETRY_TOPIC: atlas_ethereum-mainnet_ocr2_telemetry_ccip_exec_v0
    RECEIPTS_KAFKA_RECEIPTS_TOPIC: ethereum-mainnet_transactions_with_receipts
    KAFKA_CLIENT_ID: atlas-evm-ethereum-mainnet-ccip-exporter
    KAFKA_GROUP_ID: atlas-evm-ethereum-mainnet-ccip-exporter
    RPC_ENDPOINTS: http://geth-1337:8544
    LOG_LEVEL: info
    BENTHOS_CHECKPOINT_LIMIT: "3000"
    BENTHOS_FETCH_BUFFER_CAP: "3000"
    OUTPUT_MAX_RETRIES: "5"
    OUTPUT_BACKOFF_INITIAL_INTERVAL: "500ms"
    OUTPUT_BACKOFF_MAX_INTERVAL: "5s"
    OUTPUT_BACKOFF_MAX_ELAPSED_TIME: "30s"
    TLS_ENABLED: false
    ABI_DIRECTORY: /app/abis
    KAFKA_SCHEMA_REGISTRY_ENABLED: true
    KAFKA_SASL_MECHANISM: "none"
    KAFKA_SASL_USERNAME:
    KAFKA_SASL_PASSWORD:

atlas-evm-ccip:
  <<: *base
  topologySpreadConstraints: []
  name: crib-evm-ccip-ethereum-mainnet
  envVars:
    APP_NAME: crib-evm-ccip-network-ethereum-mainnet
    BLOCKS_KAFKA_BLOCK_HEADERS_TOPIC: ethereum-mainnet-ccip-network-1
    CHAIN_ID: 1337
    KAFKA_CLIENT_ID: atlas-evm-ethereum-mainnet-ccip-network-1-ccip
    KAFKA_GROUP_ID: atlas-evm-ethereum-mainnet-ccip-network-1-ccip
    KAFKA_LOGS_TOPIC: ethereum-mainnet_logs
    NETWORK_NAME: ethereum-mainnet
    RECEIPTS_KAFKA_RECEIPTS_TOPIC: ethereum-mainnet-ccip-network-1
    RPC_ENDPOINTS: http://geth-1337:8544
    LOG_LEVEL: info
    BENTHOS_CHECKPOINT_LIMIT: "3000"
    BENTHOS_FETCH_BUFFER_CAP: "3000"
    OUTPUT_MAX_RETRIES: "50"
    OUTPUT_BACKOFF_INITIAL_INTERVAL: "500ms"
    OUTPUT_BACKOFF_MAX_INTERVAL: "5s"
    OUTPUT_BACKOFF_MAX_ELAPSED_TIME: "0s"
    TLS_ENABLED: false
    KAFKA_START_FROM_OLDEST: true
    KAFKA_SCHEMA_REGISTRY_ENABLED: true
    KAFKA_SECURITY_PROTOCOL: PLAINTEXT
    KAFKA_SASL_MECHANISM: "none"
    KAFKA_SASL_USERNAME:
    KAFKA_SASL_PASSWORD:
    KAFKA_SCHEMA_REGISTRY_BASIC_AUTH: "false"
    ABI_DIRECTORY: "/app/abis"
